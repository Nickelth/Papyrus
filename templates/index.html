<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>帳票出力画面</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body style="margin: 40px;">
    <div class="container my-4">
        <h1 class="mb-4 fw-bold">帳票出力画面</h1>
        <p>お客様名: 田中　太郎</p>
        <div class="card p-4 mb-4">
            <div class="card-title mb-3">商品情報入力</div>
            <form id="input-form" method="post" action="/index">
                <div class="d-flex mb-3">
                    <div>
                        <label for="sku" class="form-label label-title mr-1">商品コード<span class="text-danger">*</span></label>
                        <input type="text" name="sku" id="sku" required><br>
                    </div>
                    <div class="ms-2">
                        <label for="name" class="form-label label-title">商品名<span class="text-danger">*</span></label>
                        <input type="text" name="name" id="name" required><br>
                    </div>
                </div>
                <div class="d-flex mb-3">
                    <div>
                        <label for="qty" class="form-label label-title">数量<span class="text-danger">*</span></label>
                        <input type="number" name="qty" id="qty" required min="1"><br>
                    </div>
                    <div class="ms-2">
                        <label for="unit_price" class="form-label label-title">単価（円）<span class="text-danger">*</span></label>
                        <input type="number" name="unit_price" id="unit_price" required min="1"><br>
                    </div>
                    <div class="ms-2">
                        <label for="note" class="form-label label-title">備考</label>
                        <input type="text" name="note" id="note"><br>
                    </div>
                    <input type="hidden" name="action" value="add">
                </div>
            </form>
            <div class="d-flex gap-2 button-area no-print">
                <button type="submit" form="input-form" class="btn btn-outline-success">納品リストに追加</button>
                <form method="post" action="/index">
                    <input type="hidden" name="action" value="clear">
                    <button type="submit" class="btn btn-secondary">クリア</button>
                </form>
            </div>
        </div>    
        <div class="card p-4">
            <h5 class="card-title mb-3">納品リスト</h5>
            <table class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        <th>商品コード</th>
                        <th>商品名</th>
                        <th>数量</th>
                        <th>単価</th>
                        <th>金額</th>
                        <th>備考</th>
                    </tr>
                    {% for item in delivery_list %}
                </thead>
                <tbody>
                    <tr>
                        <td>{{ item.sku }}</td>
                        <td>{{ item.name }}</td>
                        <td>{{ item.unit_price }} 円</td>
                        <td>{{ item.qty }} 台</td>
                        <td>{{ item.total }} 円</td>
                        <td>{{ item.note }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="button-area no-print d-flex gap-2 mt-3">
            <form action="/generate_pdf" method="post">
                <button type="submit" name="action" value="print" class="btn btn-outline-success">
                    <i class="bi bi-file-earmark-pdf"></i>PDFで出力する
                </button>
            </form>
            <form action="/index" method="post">
                <button type="submit" name="action" value="clear_list" class="btn btn-secondary">クリア</button>
            </form>
        </div>
    </div>
</body>
<script>
document.getElementById("sku").addEventListener("blur", function() {
    const sku = this.value;
    fetch(`/api/product_by_sku?sku=${encodeURIComponent(sku)}`)
      .then(res => res.json())
      .then(data => {
        if (data) {
          document.getElementById("name").value = data.name;
          document.getElementById("unit_price").value = data.unit_price;
        }
      });
});

document.getElementById("name").addEventListener("blur", function() {
    const name = this.value;
    fetch(`/api/product_by_name?name=${encodeURIComponent(name)}`)
      .then(res => res.json())
      .then(data => {
        if (data) {
          document.getElementById("sku").value = data.sku;
          document.getElementById("unit_price").value = data.unit_price;
        }
      });
});
</script>
<style>
.label-title {
  width: 5.5rem;
}
</style>
</html>
